primes ← {
  ⍺≤⊃⍵:⍵
  ⍺>2*⍨⊃⍵:⍺∇(2*⍨⊃⍵)∇⍵
  o←⍺{(⍵+2|⍵+1)+2×¯1+⍳⌈0.5×⍺-⍵}⊃⍵
  p←⍺{⍵/⍨⍵≤⍺*0.5}2⊃⍵
  s←{0=≢⍵:⍺ ⋄ (⍺/⍨0≠⍺|⍨⊃⍵)∇1↓⍵}
  ⍺,⊂(2⊃⍵),o s p
}

nprimes ← {
  ⍺≤≢⍵:⍵
  ⍺>2×≢⍵:⍺ ∇(2×≢⍵)∇ ⍵
  l←⊃¯1↑⍵ ⋄ h←l+l>2 ⋄ t←⌈l×2
  ⍺ ∇ 2⊃t primes h ⍵
}
